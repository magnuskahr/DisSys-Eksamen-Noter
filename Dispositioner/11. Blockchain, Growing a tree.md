* Motivation
* Totally Ordered Broadcast
	* Ideen
	* Blochchain l칮sning
	* Cryptocurrencies
* Blockchains
	* Lotteri system
	* Vinde puljen
	* Hardness v칝rdi
	* Proof of stake
		* Tickets
		* F칮rste runde
		* Anden runde
		* Pulje J
		* Sikkerhed: DDOS og SEED
	* Gro et tr칝
		* Bedste sti
		* Eksempel
		* Rollback

# Blockchain, Growing a tree

## Motivation

En blockchain er en 친ben m친de at holde styr p친 vigtig data p친. Det tillader alle at tjekke og garantere dens data; og den er meget sv칝r at manipulere med.

## Totally Ordered Broadcast

Blockchain er blot en af mange m친der at implementere Totally Ordered Broadcast p친.

### Ideen

**Ideen** ved Total Order Broadcast er at, uanset hvad - vil **alle parter modtage beskeder i pr칝cis samme r칝kkef칮lge**.

> TOB: samme r칝kkef칮lge for alle

Helt basalt virker det ved; at **sorter beskeder efter causal ordering** - hvilket vil sige; at hvis en besked **m2 muligvis har er baseret p친 en anden besked m1**, skal m2 komme efter m1. Hvis der er nogle **concurrente** beskeder; s친 sortere vi dem efter en **deterministisk total ordering**; alts친 at alle parter vi kunne **n친 samme konklusion p친 en sortering**.

### Blochchain l칮sning

En **blockchain** er er **rimelig selvforklarende** for hvordan den l칮ser dette problem; den har simpelthen en **l칝nke af disse blokke** og dets beskeder.

Flere forskellige **parter vil have** disse l칝nker; eller ogs친 kaldt **tr칝er. Ideen er baseret p친 State Machine Replicatation,** hvor en gruppe af maskiner skal fors칮ge at blive enige om et evigt-voksende s칝t af operationer.

### Cryptocurrencies

Dette bliver i disse dage, popul칝rt **brugt til at lave cryptocurrencies med**. Hvis man arbejder med, at de operationer der sendes frem og tilbage, blot er **transaktioner** - kan man kort beskrevet **lave en digital valuta**.

At **cryptocurrencies** er **baseret** p친 **TOB** er faktisk en **meget vigtig ting**. Tager vi i betragtning de afleveringer vi har haft i kurset, s친 har en **konto ikke m친 g친 i negativ**; s친 det betyder noget for hvilken **r칝kkef칮lge at transaktioner kommer i** - derfor betyder det ogs친 noget at alle parter der deltager i bogf칮ringen af disse valutaer, **modtager transaktionerne i den samme r칝kkef칮lge**.

## Blockchains

> **Blockchain**

Vi har et peer-to-peer network, hvor beskeder bliver sendt rundt ved flooding.

> * Peers kan komme og g친

Vi tillader at nodes bare kan komme og g친; hvorfor vi ikke bare kan lade en lederrolle g친 p친 skift; eftersom en langsomtids bruger m친ske aldrig bliver valgt.

> * Sequeencer g친r p친 skifter

Derimod bruger vi et lotteri til at bestemme sequencer. Man **kan vinde i en** r칝kke forskellige slot-numre, eller **puljer** kan vi kalde dem, der hver i s칝r varer et hvis stykke tid. 

Det er **derfor implementeringen er synkron**, da vi **basere** vores forskellige **puljer p친** en f칝lles forst친else for **tid**.

### Lotteri system

S친 det her er jo basicly hvad det er vi sad og programmerede og svedte over i de sidste dage inden vi kunne g친 p친 juleferie; det var en kr칝vende - men dog sjov aflevering! S친 jeg burde vide noget om hvordan det virker. Men lad os nu se.

#### Vinde puljen

Efterh친nden som tiden g친r, vil man v칝re i en pulje **angivet af et nummer**. Hvis  men vil vinde puljen, s친 g칮res det ved at:

> * **Vinde pulje**
> * Signere pulje-nummet
> * Hash det

Er ens hash s친 st칮rre end en given hardness, har man vundet.

> hash > hardness

Hvilket alts친 vil sige, at der for hver pulje kan v칝re **flere vindere**.

#### Hardness v칝rdi

Den her hardness v칝rdi

> **Hardness v칝rdi**

er en given v칝rdi der skal s칮rge for - at der 

> * findes en vinder ved et givent interval 

det g칮r ogs친 at f칝rre vinder hvorfor mindre trafik; men at det kan ende med; 

> * nogle puljer har ingen vinder

#### Proof of stake

##### Tickets
Vi siger at **hver part har en antal tickets** - hvis det var en cryptocurrency kunne det f.eks v칝re antallet man havde af m칮nter. 

Disse tickets er en faktor der bliver **ganget p친 ens hash**; hvorfor des flere tickets des h칮jere mulighed har man for at vinde. 

> Tickets: des flere, des st칮rre vinder chancer

Det giver **meningen i den forstand**, at hvis man som bruger af den af cryptocurrency; s친 giver det mening at vinde hvis man har en stor opsparing - da **man 칮nsker at holde valutaen i live**.

##### F칮rste runde
> **F칮rste runde**

I f칮rste runde s친 laver alle et **key-pair** (vk, sk) til et signatur skema; hvor **vk er broadcastet** ud til alle andre parter.

> * Alle  laver (vk, sk)
> * Alle sender vk

##### Anden runde
> **Anden runde**

I runder nummer to, bliver der **sendt** et s친kaldt **Seed** rundt til alle. Dette nummer skal **ikke v칝re muligt** for parterne at **forudsige** i runde 1 - mere om det senere.

> * Seed sendes

Nu er alt sat op, og magnuses-blockchain-lottery kan 친bne! Yay! 

##### Pulje J

For hver pulje j, kan hver part tr칝kke et nummer. Det regnes ved at sige:

> **Pulje J**

> * Pi tr칝kker: `draw = SIGN(seed, j)`
> * V칝rdien er: `value = tickets * H(seed, j, draw)`

Er v칝rdien h칮j nok, sender man en blok ud med ens draw

##### Sikkerhed: DDOS og SEED

Det smarte ved det her system, er at **kun parten der kender sin secrete-key kan udregne sit draw,** men alle der har ens verifycation-key kan udregne om ens draw er korrekt.

Derfor kan **andre ikke vide hvem der har vundet** - indtil at man selv v칝lger at offentligg칮re det. Dermed er systemet, designet til at **modst친 et DoS angreb**; hvor en fremmed - vil fors칮ge at **crashe en vinder**.

For s칝t nu at en fremmed kunne udregne alle vindere af systemet, s친 kunne han fokusere p친 at crashe alle disse - hvorfor han ville dr칝be liveness af systemet.

Det bringer os tilbage til at **snakke om det her Seed** der f칮rst bliver offenligt i anden runde. Det er vigtigt at det f칮rst kommer efter, at hver part har lavet sine n칮gler; for ellers ville en part kunne **lave en n칮gle**, der med alt sandsynlighed **gav h칮je lodtr칝kninger** i nogle 칮nskede runder.

### Gro et tr칝

**N친r man vinder**, s친 **sender** man sammen med sin **draw, en blok** ud - der indeholder hvilken r칝kkef칮lge man mener beskeder skal arbejdes med i; samt **hvilken blok der er dens for칝ldre**.

**Som 칝rlig part**, vil man altid bygge videre p친 den sti man finder bedst. S친 p친 den m친de bestemmer man en bloks for칝ldre.

N친r man modtager s친dan en blok, vil s친 kigge p친s칝tte den p친 dens retm칝ssige for칝ldre - s친fremt man finder den gyldig. Derved opbygges et tr칝.

#### Bedste sti

Ud fra en rod vil et tr칝 vokse, hvor disse blokke alts친 p친s칝ttes. Men n친r en blok kan have flere b칮rn; **hvordan ved en part s친; hvad den skal se som den bedste sti af tr칝et?** 

Med andre ord, n친r vi har et tr칝 med en masse forskellig data - hvad ser vi s친 som vores **state eller vores nuv칝rende resultat**?

Hvis vi siger at hvert leaf har en **leaf weight**; s친 vil hver part tage den simple vej fra roden der har den **st칮rste samlede v칝gt**. 

Hvis der er den samme v칝gt for alle blade, vil det derved v칝re den **l칝ngste path** som er den optimale - fordi ja ... st칮rrelsen er g칮relsen 游땚 (penis joke). Man vil **altid bygge videre p친 den path man ser bedst**.

#### Eksempel

![tree growth](tree_growth.png)

1. Alle er enige om roden
2. En vinder pulje 8, men kun den ved det
3. Alle ved nu pulje 8 blev vundet og ser det som den bedste path
4. En vinder pulje 11, og f칮r en anden ser det vinder den pulje 12
5. Alle andre ser nu dette og bliver splittet
6. Der bliver vundet en pulje fra hver split
7. En i splittet vinder
8. Alle ser nu dette som den l칝ngste

Hvorfor vi nu har, at de agreer! YAY!

#### Rollback 

Hvad der lige skete her, er hvad vi kalder for et rollback. Og det kan desv칝rre ogs친 친bne op for nogle angreb. 

S칝t nu; at vi har, at nogle fremmede havde vundet nogle runder; men ikke havde offenlig gjort dem; n친r de s친 havde vundet tilpas mange der udgjorde den samlede l칝ngste path i tr칝et, kunne de publicere dem og alle vil nu flytte her over.

Man kan f.eks bek칝mpe dette, med at angive hvor langt et rollback maksimalt m친 v칝re; men dette kan ligeledes ogs친 give problemer. 

For s칝t nu at tre parter har tre blade og til roden, og en fjerde part lige havde vundet - s친 den havde fire blade der op. S친 kunne et ghost tree p친 5 blive sat op p친 roden; og hvis max-rollback er tre; vil de tre kunne g친 p친 ghost-vejen, men aldrig den fjerde. Hvorfor de nu er splittet og hvorfor der nu aldrig vil kunne komme agreement igen.